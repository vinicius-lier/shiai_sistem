{% extends 'atletas/base.html' %}

{% block title %}Lista de Atletas{% endblock %}

{% block extra_css %}
<style>
    /* Fundo branco para a p√°gina de lista de atletas */
    .main-content {
        background: #FFFFFF !important;
    }
    
    body {
        background: #FFFFFF !important;
    }
    
    .container {
        background: #FFFFFF !important;
    }
    
    .page-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 30px;
        flex-wrap: wrap;
        gap: 15px;
    }
    
    .page-header h1 {
        margin: 0;
    }
    
    .action-buttons {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
    }
    
    .filter-box {
        background: var(--card-bg);
        border: 1px solid var(--border);
        border-radius: 8px;
        padding: 20px;
        margin-bottom: 24px;
        box-shadow: 0 1px 3px var(--shadow);
    }
    
    .filter-box h3 {
        margin: 0 0 20px 0;
        font-size: 18px;
        font-weight: 600;
        color: var(--text);
        padding-bottom: 10px;
        border-bottom: 2px solid var(--border);
    }
    
    .filter-form {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 15px;
    }
    
    .filter-group {
        display: flex;
        flex-direction: column;
    }
    
    .filter-group label {
        margin-bottom: 8px;
        font-weight: 600;
        color: var(--text);
        font-size: 14px;
    }
    
    .filter-group input,
    .filter-group select {
        padding: 10px;
        border: 1px solid var(--border);
        border-radius: 8px;
        font-size: 14px;
        background: var(--card-bg);
        color: var(--text);
        transition: all 0.2s ease;
    }
    
    .filter-group input:focus,
    .filter-group select:focus {
        outline: none;
        border-color: var(--primary);
        box-shadow: 0 0 0 2px rgba(25, 118, 210, 0.1);
    }
    
    [data-theme="dark"] .filter-group input:focus,
    [data-theme="dark"] .filter-group select:focus {
        box-shadow: 0 0 0 2px rgba(100, 181, 246, 0.2);
    }
    
    .filter-actions {
        grid-column: 1 / -1;
        display: flex;
        gap: 10px;
        margin-top: 10px;
    }
    
    /* Grid de Cards de Atletas */
    .atletas-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
    }
    
    /* Card de Atleta */
    .atleta-card {
        background: var(--card-bg);
        border: 1px solid var(--border);
        border-radius: 8px;
        padding: 24px;
        box-shadow: 0 1px 3px var(--shadow);
        transition: all 0.2s ease;
        position: relative;
    }
    
    .atleta-card:hover {
        box-shadow: 0 4px 12px var(--shadow);
        transform: translateY(-2px);
    }
    
    .atleta-card-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: 20px;
    }
    
    .atleta-card-actions {
        display: flex;
        gap: 8px;
    }
    
    .btn-card-action {
        width: 36px;
        height: 36px;
        border-radius: 6px;
        display: flex;
        align-items: center;
        justify-content: center;
        text-decoration: none;
        font-size: 16px;
        transition: all 0.2s ease;
        border: none;
        cursor: pointer;
    }
    
    .btn-card-edit {
        background: var(--primary);
        color: white;
    }
    
    .btn-card-edit:hover {
        background: var(--primary-hover);
        transform: scale(1.05);
    }
    
    .btn-card-delete {
        background: var(--danger);
        color: white;
    }
    
    .btn-card-delete:hover {
        background: var(--danger-hover);
        transform: scale(1.05);
    }
    
    .atleta-card-content {
        display: flex;
        gap: 20px;
        margin-bottom: 20px;
    }
    
    .atleta-photo {
        width: 128px;
        height: 128px;
        border-radius: 8px;
        object-fit: cover;
        border: 2px solid var(--border);
        background: var(--bg);
        flex-shrink: 0;
    }
    
    .atleta-photo-placeholder {
        width: 128px;
        height: 128px;
        border-radius: 8px;
        background: var(--bg);
        border: 2px solid var(--border);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 64px;
        color: var(--text-sec);
        flex-shrink: 0;
    }
    
    .atleta-info {
        flex: 1;
    }
    
    .atleta-nome {
        font-size: 20px;
        font-weight: 700;
        color: var(--text);
        margin: 0 0 12px 0;
    }
    
    .atleta-details {
        display: flex;
        flex-direction: column;
        gap: 8px;
    }
    
    .atleta-detail-item {
        display: flex;
        align-items: center;
        gap: 8px;
        font-size: 14px;
        color: var(--text);
    }
    
    .atleta-detail-label {
        font-weight: 600;
        color: var(--text-sec);
        min-width: 80px;
    }
    
    .atleta-academia {
        color: var(--primary);
        font-weight: 600;
    }
    
    .atleta-stats {
        display: flex;
        gap: 20px;
        padding-top: 20px;
        border-top: 1px solid var(--border);
    }
    
    .atleta-stat {
        display: flex;
        align-items: center;
        gap: 8px;
        font-size: 14px;
        color: var(--text);
    }
    
    .atleta-stat-value {
        font-weight: 700;
        color: #FFD700;
        font-size: 18px;
    }
    
    .status-badge {
        padding: 4px 10px;
        border-radius: 4px;
        font-size: 11px;
        font-weight: 600;
        white-space: nowrap;
        display: inline-block;
        margin-top: 10px;
    }
    
    .badge-ok {
        background: rgba(46, 125, 50, 0.1);
        color: var(--success);
        border: 1px solid var(--success);
    }
    
    .badge-eliminado {
        background: rgba(211, 47, 47, 0.1);
        color: var(--danger);
        border: 1px solid var(--danger);
    }
    
    .badge-festival {
        background: rgba(255, 193, 7, 0.1);
        color: #F57C00;
        border: 1px solid #F57C00;
    }
    
    .empty-state {
        text-align: center;
        padding: 60px 20px;
        background: var(--card-bg);
        border: 1px solid var(--border);
        border-radius: 8px;
        grid-column: 1 / -1;
    }
    
    .empty-state-icon {
        font-size: 64px;
        margin-bottom: 20px;
        opacity: 0.5;
    }
    
    .empty-state-text {
        font-size: 18px;
        color: var(--text-sec);
        margin-bottom: 20px;
    }
    
    .results-summary {
        background: var(--card-bg);
        border: 1px solid var(--border);
        border-radius: 8px;
        padding: 14px 20px;
        margin-bottom: 20px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        flex-wrap: wrap;
        gap: 15px;
        box-shadow: 0 1px 3px var(--shadow);
    }
    
    .results-count {
        font-size: 16px;
        font-weight: 600;
        color: var(--text);
    }
    
    @media (max-width: 768px) {
        .filter-form {
            grid-template-columns: 1fr;
        }
        
        .filter-actions {
            grid-column: 1;
        }
        
        .page-header {
            flex-direction: column;
            align-items: stretch;
        }
        
        .action-buttons {
            width: 100%;
        }
        
        .action-buttons .btn {
            flex: 1;
        }
        
        .atletas-grid {
            grid-template-columns: 1fr;
        }
        
        .atleta-card-content {
            flex-direction: column;
            align-items: center;
            text-align: center;
        }
        
        .atleta-photo,
        .atleta-photo-placeholder {
            width: 100px;
            height: 100px;
        }
        
        .atleta-info {
            width: 100%;
        }
        
        .atleta-stats {
            justify-content: center;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="page-header">
    <h1>üë• Lista de Atletas</h1>
    <div class="action-buttons">
        <a href="{% url 'cadastrar_atleta' %}" class="btn" style="background: var(--primary);">‚ûï Cadastrar Atleta</a>
        <a href="{% url 'importar_atletas' %}" class="btn" style="background: var(--success);">üì• Importar</a>
        <a href="?{% if request.GET %}{{ request.GET.urlencode }}&{% endif %}modo=imprimir" class="btn" style="background: var(--text-sec);">üñ® Imprimir</a>
    </div>
</div>

{% if total_encontrados > 0 %}
<div class="results-summary">
    <div class="results-count">üìä Total encontrado: <strong>{{ total_encontrados }}</strong> atleta(s)</div>
</div>
{% endif %}

<div class="filter-box">
    <h3>üîç Filtros de Busca</h3>
    <form method="get" class="filter-form">
        <div class="filter-group">
            <label for="nome">Nome:</label>
            <input type="text" id="nome" name="nome" value="{{ nome_filtro }}" placeholder="Buscar por nome">
        </div>
        
        <div class="filter-group">
            <label for="classe">Classe:</label>
            <select id="classe" name="classe">
                <option value="">Todas</option>
                {% for classe in classes %}
                <option value="{{ classe }}" {% if classe == classe_filtro %}selected{% endif %}>{{ classe }}</option>
                {% endfor %}
            </select>
        </div>
        
        <div class="filter-group">
            <label for="sexo">Sexo:</label>
            <select id="sexo" name="sexo">
                <option value="">Todos</option>
                <option value="M" {% if sexo_filtro == 'M' %}selected{% endif %}>Masculino</option>
                <option value="F" {% if sexo_filtro == 'F' %}selected{% endif %}>Feminino</option>
            </select>
        </div>
        
        <div class="filter-group">
            <label for="categoria">Categoria:</label>
            <input type="text" id="categoria" name="categoria" value="{{ categoria_filtro }}" placeholder="Buscar categoria">
        </div>
        
        <div class="filter-group">
            <label for="academia">Academia:</label>
            <select id="academia" name="academia">
                <option value="">Todas</option>
                {% for academia in academias %}
                <option value="{{ academia.id }}" {% if academia_filtro|default:""|stringformat:"s" == academia.id|stringformat:"s" %}selected{% endif %}>{% if academia.sigla %}[{{ academia.sigla }}] {% endif %}{{ academia.nome }}</option>
                {% endfor %}
            </select>
        </div>
        
        <div class="filter-group">
            <label for="status">Status:</label>
            <select id="status" name="status">
                <option value="">Todos</option>
                <option value="OK" {% if status_filtro == 'OK' %}selected{% endif %}>OK</option>
                <option value="Eliminado Peso" {% if status_filtro == 'Eliminado Peso' %}selected{% endif %}>Eliminado por Peso</option>
                <option value="Eliminado Indisciplina" {% if status_filtro == 'Eliminado Indisciplina' %}selected{% endif %}>Eliminado por Indisciplina</option>
            </select>
        </div>
        
        <div class="filter-group">
            <label for="faixa">Faixa:</label>
            <input type="text" id="faixa" name="faixa" value="{{ faixa_filtro }}" placeholder="Buscar por faixa">
        </div>
        
        <div class="filter-group">
            <label for="ordenar">Ordenar por:</label>
            <select id="ordenar" name="ordenar">
                <option value="nome" {% if ordenacao == 'nome' %}selected{% endif %}>Nome</option>
                <option value="classe" {% if ordenacao == 'classe' %}selected{% endif %}>Classe</option>
                <option value="categoria_nome" {% if ordenacao == 'categoria_nome' %}selected{% endif %}>Categoria</option>
                <option value="academia__nome" {% if ordenacao == 'academia__nome' %}selected{% endif %}>Academia</option>
                <option value="peso_oficial" {% if ordenacao == 'peso_oficial' %}selected{% endif %}>Peso</option>
                <option value="status" {% if ordenacao == 'status' %}selected{% endif %}>Status</option>
            </select>
        </div>
        
        <div class="filter-actions">
            <button type="submit" class="btn" style="background: var(--primary); flex: 1;">üîç Aplicar Filtros</button>
            <a href="{% url 'lista_atletas' %}" class="btn" style="background: var(--text-sec); flex: 1; text-align: center;">üîÑ Limpar</a>
        </div>
    </form>
</div>

<div class="atletas-grid">
    {% for atleta in atletas %}
    <div class="atleta-card">
        <div class="atleta-card-header">
            <div></div>
            <div class="atleta-card-actions">
                <a href="{% url 'editar_atleta' atleta.id %}" class="btn-card-action btn-card-edit" title="Editar Atleta">
                    ‚úèÔ∏è
                </a>
                <a href="{% url 'detalhe_atleta' atleta.id %}" class="btn-card-action btn-card-edit" title="Ver Detalhes">
                    üëÅÔ∏è
                </a>
            </div>
        </div>
        
        <div class="atleta-card-content">
            <div>
                <div class="atleta-photo-placeholder">ü•ã</div>
            </div>
            
            <div class="atleta-info">
                <h3 class="atleta-nome">{{ atleta.nome }}</h3>
                
                <div class="atleta-details">
                    <div class="atleta-detail-item">
                        <span class="atleta-detail-label">Classe:</span>
                        <span>{{ atleta.classe|default:"-" }}</span>
                    </div>
                    <div class="atleta-detail-item">
                        <span class="atleta-detail-label">Sexo:</span>
                        <span>{{ atleta.get_sexo_display }}</span>
                    </div>
                    <div class="atleta-detail-item">
                        <span class="atleta-detail-label">Federado:</span>
                        <span>
                            {% if atleta.federado %}
                                <span style="color: var(--success); font-weight: 600;">‚úî Sim</span>
                                {% if atleta.zempo %}
                                    <span style="color: var(--primary); margin-left: 8px;">‚Ä¢ {{ atleta.zempo }}</span>
                                {% else %}
                                    <span style="color: var(--danger); margin-left: 8px;">‚Ä¢ Sem ZEMPO!</span>
                                {% endif %}
                            {% else %}
                                <span style="color: #9E9E9E;">‚úò N√£o</span>
                            {% endif %}
                        </span>
                    </div>
                    <div class="atleta-detail-item">
                        <span class="atleta-detail-label">Faixa:</span>
                        <span>{{ atleta.faixa }}</span>
                    </div>
                    <div class="atleta-detail-item">
                        <span class="atleta-detail-label">Academia:</span>
                        <span class="atleta-academia">
                            {% if atleta.academia.sigla %}[{{ atleta.academia.sigla }}] {% endif %}{{ atleta.academia.nome }}
                        </span>
                    </div>
                    <div class="atleta-detail-item">
                        <span class="atleta-detail-label">Categoria:</span>
                        <span>{{ atleta.categoria_ajustada|default:atleta.categoria_nome|default:"-" }}</span>
                    </div>
                    {% if atleta.peso_oficial %}
                    <div class="atleta-detail-item">
                        <span class="atleta-detail-label">Peso:</span>
                        <span><strong>{{ atleta.peso_oficial }} kg</strong></span>
                    </div>
                    {% endif %}
                </div>
                
                {% if atleta.classe == 'Festival' %}
                    <span class="status-badge badge-festival">üèÖ Festival</span>
                {% elif atleta.status == 'OK' %}
                    <span class="status-badge badge-ok">‚úì OK</span>
                {% else %}
                    <span class="status-badge badge-eliminado">‚úó {{ atleta.status }}</span>
                {% endif %}
                {% if atleta.remanejado %}
                    <br><small style="color: var(--warning); margin-top: 5px; display: inline-block;">‚ö†Ô∏è Remanejado</small>
                {% endif %}
            </div>
        </div>
        
        <div class="atleta-stats">
            <div class="atleta-stat">
                <span>ü•á</span>
                <div>
                    <div class="atleta-stat-value">{{ atleta.get_medalhas_count }}</div>
                    <div style="font-size: 11px; color: var(--text-sec);">Medalhas</div>
                </div>
            </div>
            <div class="atleta-stat">
                <span>üèÜ</span>
                <div>
                    <div class="atleta-stat-value">{{ atleta.get_participacoes_count }}</div>
                    <div style="font-size: 11px; color: var(--text-sec);">Participa√ß√µes</div>
                </div>
            </div>
        </div>
    </div>
    {% empty %}
    <div class="empty-state">
        <div class="empty-state-icon">üë•</div>
        <div class="empty-state-text">Nenhum atleta encontrado com os filtros aplicados</div>
        <a href="{% url 'cadastrar_atleta' %}" class="btn" style="margin-top: 20px;">Cadastrar Primeiro Atleta</a>
    </div>
    {% endfor %}
</div>
{% endblock %}
