{% extends "atletas/layouts/base_operational.html" %}
{% load static %}

{% block title %}Dashboard - Sistema de Gestao de Competicoes de Judo{% endblock %}

{% block content %}
<section class="saas-header">
  <div>
    <h1 class="saas-title">Fluxos principais do sistema</h1>
    <p class="saas-subtitle">Acesse rapidamente os processos operacionais do evento em andamento.</p>
  </div>
</section>

<section class="workflow-grid">
  <article class="workflow-card">
    <div class="workflow-card-header">
      <div class="workflow-icon is-linkedin">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
          <circle cx="9" cy="7" r="4"></circle>
          <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
          <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
        </svg>
      </div>
      <span class="workflow-badge">Operacional</span>
    </div>
    <h3 class="workflow-title">Inscricoes</h3>
    <p class="workflow-desc">Gerencie atletas inscritos e confirme a participacao.</p>
    <div class="workflow-meta">
      <span class="workflow-badge">Fluxo</span>
      <a class="workflow-cta" href="{% url 'inscrever_atletas' organizacao_slug=request.organizacao.slug %}">Acessar</a>
    </div>
  </article>

  <article class="workflow-card">
    <div class="workflow-card-header">
      <div class="workflow-icon is-gmail">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M6 2v6"></path>
          <path d="M18 2v6"></path>
          <path d="M3 10h18"></path>
          <rect x="3" y="4" width="18" height="18" rx="2"></rect>
        </svg>
      </div>
      <span class="workflow-badge is-paid">Evento</span>
    </div>
    <h3 class="workflow-title">Pesagem</h3>
    <p class="workflow-desc">Registre pesos oficiais e valide as categorias.</p>
    <div class="workflow-meta">
      <span class="workflow-badge is-paid">Fluxo</span>
      <a class="workflow-cta" href="{% url 'pesagem' organizacao_slug=request.organizacao.slug %}">Acessar</a>
    </div>
  </article>

  <article class="workflow-card">
    <div class="workflow-card-header">
      <div class="workflow-icon is-instagram">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <polyline points="22 12 18 12 15 21 9 3 6 12 2 12"></polyline>
        </svg>
      </div>
      <span class="workflow-badge">Operacional</span>
    </div>
    <h3 class="workflow-title">Chaves</h3>
    <p class="workflow-desc">Gere chaves e acompanhe o andamento das lutas.</p>
    <div class="workflow-meta">
      <span class="workflow-badge">Fluxo</span>
      <a class="workflow-cta" href="{% url 'lista_chaves' organizacao_slug=request.organizacao.slug %}">Acessar</a>
    </div>
  </article>

  <article class="workflow-card">
    <div class="workflow-card-header">
      <div class="workflow-icon is-twitter">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="12" y1="20" x2="12" y2="10"></line>
          <line x1="18" y1="20" x2="18" y2="4"></line>
          <line x1="6" y1="20" x2="6" y2="16"></line>
        </svg>
      </div>
      <span class="workflow-badge is-paid">Ranking</span>
    </div>
    <h3 class="workflow-title">Rankings</h3>
    <p class="workflow-desc">Acompanhe a pontuacao de atletas e academias.</p>
    <div class="workflow-meta">
      <span class="workflow-badge is-paid">Fluxo</span>
      <a class="workflow-cta" href="{% url 'ranking_academias' organizacao_slug=request.organizacao.slug %}">Acessar</a>
    </div>
  </article>
</section>

<section class="analytics-grid">
  <div class="panel ranking-card">
    <div class="ranking-card-header ranking-card-header--primary">
      <div class="ranking-card-header-content">
        <div>
          <h3 class="ranking-card-title">Ranking de Academias</h3>
          <p class="ranking-card-subtitle">Top 3 do evento em destaque</p>
        </div>
        <a class="btn ranking-card-action" href="{% url 'ranking_academias' organizacao_slug=request.organizacao.slug %}">Ver ranking</a>
      </div>
    </div>
    <div class="ranking-card-body">
      {% if ranking_academias_completo %}
      <div class="ranking-top3 ranking-top3--game">
        {% for item in ranking_academias_completo|slice:":3" %}
        <div class="ranking-podium-item {% if forloop.counter == 1 %}ranking-podium-item--first{% elif forloop.counter == 2 %}ranking-podium-item--second{% else %}ranking-podium-item--third{% endif %}">
          <div class="ranking-avatar-wrap">
            <div class="ranking-avatar {% if forloop.counter == 1 %}ranking-avatar--gold{% elif forloop.counter == 2 %}ranking-avatar--silver{% else %}ranking-avatar--bronze{% endif %}">
              {% if item.academia.foto_perfil %}
                <img src="{{ item.academia.foto_perfil.url }}" alt="{{ item.academia.nome }}">
              {% else %}
                <img src="{% static 'atletas/images/logo_black.png' %}" alt="SHIAI">
              {% endif %}
            </div>
            <span class="ranking-medal {% if forloop.counter == 1 %}ranking-medal--gold{% elif forloop.counter == 2 %}ranking-medal--silver{% else %}ranking-medal--bronze{% endif %}">
              {% if forloop.counter == 1 %}ðŸ‘‘{% elif forloop.counter == 2 %}ðŸ¥ˆ{% else %}ðŸ¥‰{% endif %}
            </span>
          </div>
          <div class="ranking-name">{{ item.academia.nome }}</div>
          <div class="ranking-subtitle">{{ item.pontos_totais }} pts</div>
        </div>
        {% endfor %}
      </div>
      {% else %}
      <div class="empty-state">
        <div class="empty-state-title">Ranking indisponivel</div>
        <div class="empty-state-description">Cadastre resultados para gerar o ranking global.</div>
      </div>
      {% endif %}
    </div>
  </div>
  <div class="panel">
    <div class="panel-header">
      <h3 class="panel-title">Total de inscritos</h3>
    </div>
    <div class="donut-wrap">
      <div class="donut">
        <div class="donut-center">
          {{ total_inscricoes|default:0 }}
          <span>Atletas</span>
        </div>
      </div>
      <p class="saas-subtitle">Academias ativas: {{ total_academias|default:0 }}</p>
    </div>
  </div>
</section>

<section class="table-panel">
  <div class="panel-header">
    <h3 class="panel-title">Indicadores operacionais</h3>
  </div>
  <table>
    <thead>
      <tr>
        <th>Indicador</th>
        <th>Valor</th>
        <th>Detalhe</th>
        <th>Status</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>Inscricoes</td>
        <td>{{ total_inscricoes|default:0 }}</td>
        <td>Federados: {{ inscricoes_federados|default:0 }} | Nao federados: {{ inscricoes_nao_federados|default:0 }}</td>
        <td><span class="status-badge status-active">Ativo</span></td>
      </tr>
      <tr>
        <td>Academias</td>
        <td>{{ total_academias|default:0 }}</td>
        <td>Academias participantes</td>
        <td><span class="status-badge status-active">Ativo</span></td>
      </tr>
      <tr>
        <td>Chaves</td>
        <td>{{ total_chaves|default:0 }}</td>
        <td>Chaves geradas no evento</td>
        <td><span class="status-badge status-running">Em andamento</span></td>
      </tr>
    </tbody>
  </table>
</section>
{% endblock %}
