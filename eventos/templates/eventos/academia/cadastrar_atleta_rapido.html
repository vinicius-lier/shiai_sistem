{% extends 'atletas/base.html' %}

{% block title %}Cadastrar Novo Atleta{% endblock %}

{% block content %}
<h1>âž• Cadastrar Novo Atleta</h1>
<p style="color: var(--text-sec);">Evento: <strong>{{ evento.nome }}</strong></p>

<form method="post" style="max-width: 600px; margin-top: 30px;">
    {% csrf_token %}
    
    <div style="background: var(--card-bg); border: 1px solid var(--border); border-radius: 8px; padding: 30px;">
        <div style="margin-bottom: 20px;">
            <label for="nome">Nome Completo *</label>
            <input type="text" id="nome" name="nome" required style="width: 100%;">
        </div>
        
        <div style="margin-bottom: 20px;">
            <label for="ano_nasc">Ano de Nascimento *</label>
            <input type="number" id="ano_nasc" name="ano_nasc" required min="1900" max="{% now 'Y' %}" 
                   value="{% now 'Y' %}" style="width: 100%;">
            <small style="color: var(--text-sec); display: block; margin-top: 5px;">
                A classe serÃ¡ calculada automaticamente baseada na idade.
            </small>
        </div>
        
        <div style="margin-bottom: 20px;">
            <label for="sexo">Sexo *</label>
            <select id="sexo" name="sexo" required style="width: 100%;">
                <option value="">Selecione...</option>
                <option value="M">Masculino</option>
                <option value="F">Feminino</option>
            </select>
        </div>
        
        <div style="margin-bottom: 20px;">
            <label for="faixa">Faixa *</label>
            <input type="text" id="faixa" name="faixa" required placeholder="Ex: Branca, Amarela, Laranja..." style="width: 100%;">
        </div>
        
        <div style="margin-bottom: 20px;">
            <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                <input type="checkbox" id="federado" name="federado" onchange="toggleZempo()" style="width: 20px; height: 20px; cursor: pointer;">
                <span>Ã‰ federado?</span>
            </label>
            <small style="color: var(--text-sec); display: block; margin-top: 5px;">
                Marque se o atleta possui registro na CBJ/FJERJ.
            </small>
        </div>
        
        <div id="zempo-group" style="margin-bottom: 20px; display: none; opacity: 0; transition: opacity 0.3s ease;">
            <label for="zempo">NÃºmero ZEMPO *</label>
            <input type="text" id="zempo" name="zempo" placeholder="Ex: 123456" style="width: 100%;">
            <small style="color: var(--text-sec); display: block; margin-top: 5px;">
                ObrigatÃ³rio para atletas federados.
            </small>
        </div>
        
        {% if is_operacional and academias %}
        <div style="margin-bottom: 20px;">
            <label for="academia">Academia *</label>
            <select id="academia" name="academia" required style="width: 100%;">
                <option value="">Selecione uma academia...</option>
                {% for acad in academias %}
                <option value="{{ acad.id }}">
                    {% if acad.sigla %}[{{ acad.sigla }}] {% endif %}{{ acad.nome }}
                </option>
                {% endfor %}
            </select>
            <small style="color: var(--text-sec); display: block; margin-top: 5px;">
                Selecione a academia do atleta.
            </small>
        </div>
        {% else %}
        <input type="hidden" name="academia" value="{{ request.user.profile.academia.id }}">
        <div style="margin-bottom: 20px; padding: 12px; background: var(--bg); border-radius: 6px; border-left: 4px solid var(--primary);">
            <small style="color: var(--text-sec);">
                <strong>Academia:</strong> {% if request.user.profile.academia.sigla %}[{{ request.user.profile.academia.sigla }}] {% endif %}{{ request.user.profile.academia.nome }}
            </small>
        </div>
        {% endif %}
    </div>
    
    <div style="display: flex; gap: 15px; margin-top: 24px;">
        <button type="submit" class="btn">ðŸ’¾ Cadastrar e Voltar</button>
        <a href="{% url 'eventos:inscrever_atletas' evento.id %}" class="btn btn-secondary">Cancelar</a>
    </div>
</form>

<script>
function toggleZempo() {
    const federado = document.getElementById('federado').checked;
    const zempoGroup = document.getElementById('zempo-group');
    const zempoInput = document.getElementById('zempo');
    
    if (federado) {
        zempoGroup.style.display = 'block';
        setTimeout(() => {
            zempoGroup.style.opacity = '1';
        }, 10);
        zempoInput.required = true;
    } else {
        zempoGroup.style.opacity = '0';
        setTimeout(() => {
            if (!document.getElementById('federado').checked) {
                zempoGroup.style.display = 'none';
            }
        }, 300);
        zempoInput.required = false;
        zempoInput.value = '';
    }
}
</script>
{% endblock %}

