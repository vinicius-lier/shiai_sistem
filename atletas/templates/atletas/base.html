<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
    <title>{% block title %}Sistema de Gest√£o de Competi√ß√µes de Jud√¥{% endblock %}</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 10px;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            padding: 16px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        h1 {
            color: #333;
            margin-bottom: 20px;
            border-bottom: 3px solid #667eea;
            padding-bottom: 10px;
        }
        h2 {
            color: #555;
            margin: 20px 0 10px 0;
        }
        nav {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 20px;
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }
        nav a {
            display: inline-block;
            padding: 8px 12px;
            background: #667eea;
            color: white;
            text-decoration: none;
            border-radius: 5px;
            transition: background 0.3s;
            font-size: 13px;
        }
        nav a:hover {
            background: #5568d3;
        }
        .table-responsive {
            width: 100%;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
            margin: 16px 0;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            min-width: 100%;
        }
        table th, table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        table th {
            background: #667eea;
            color: white;
            font-weight: bold;
        }
        table tr:hover {
            background: #f5f5f5;
        }
        form {
            margin: 20px 0;
        }
        form label {
            display: block;
            margin: 10px 0 5px 0;
            font-weight: bold;
            color: #555;
        }
        form input, form select, form textarea {
            width: 100%;
            max-width: 400px;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
        }
        form button, .btn {
            background: #667eea;
            color: white;
            padding: 12px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            margin: 5px;
            text-decoration: none;
            display: inline-block;
            min-height: 44px;
        }
        form button:hover, .btn:hover {
            background: #5568d3;
        }
        .btn-danger {
            background: #dc3545;
        }
        .btn-danger:hover {
            background: #c82333;
        }
        .btn-success {
            background: #28a745;
        }
        .btn-success:hover {
            background: #218838;
        }
        .alert {
            padding: 15px;
            margin: 20px 0;
            border-radius: 5px;
        }
        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .alert-danger {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .status-ok {
            color: #28a745;
            font-weight: bold;
        }
        .status-eliminado {
            color: #dc3545;
            font-weight: bold;
        }
        .filter-box {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            margin: 20px 0;
        }
        .filter-box form {
            display: flex;
            gap: 10px;
            align-items: end;
            flex-wrap: wrap;
        }
        .filter-box form label {
            margin: 0;
        }
        .stats {
            display: flex;
            gap: 20px;
            margin: 20px 0;
            flex-wrap: wrap;
        }
        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 5px;
            flex: 1;
            min-width: 200px;
        }
        .stat-card h3 {
            margin: 0 0 10px 0;
            font-size: 14px;
        }
        .stat-card .number {
            font-size: 32px;
            font-weight: bold;
        }
        .mobile-only { display: none; }
        .desktop-only { display: block; }
        @media (max-width: 640px) {
            body {
                padding: 8px;
            }
            .container {
                padding: 12px;
                box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            }
            nav {
                flex-direction: column;
                align-items: stretch;
            }
            nav a {
                width: 100%;
                text-align: center;
                font-size: 14px;
            }
            h1 {
                font-size: 20px;
            }
            h2 {
                font-size: 16px;
            }
            table th, table td {
                padding: 8px;
                font-size: 12px;
            }
            .filter-box form {
                flex-direction: column;
                align-items: stretch;
            }
            .stat-card {
                min-width: 100%;
                padding: 14px;
            }
            .stat-card .number {
                font-size: 24px;
            }
            .mobile-only { display: block; }
            .desktop-only { display: none; }
        }
        @media (min-width: 641px) and (max-width: 1024px) {
            body {
                padding: 16px;
            }
            .container {
                padding: 20px;
            }
        }
    </style>
    {% block extra_css %}{% endblock %}
</head>
<body>
    <div class="container">
        <nav>
            <a href="{% url 'index' %}">In√≠cio</a>
            <a href="{% url 'lista_atletas' %}">Atletas</a>
            <a href="{% url 'cadastrar_atleta' %}">Cadastrar Atleta</a>
            <a href="{% url 'cadastrar_festival' %}">üèÖ Festival</a>
            <a href="{% url 'lista_academias' %}">Academias</a>
            <a href="{% url 'lista_categorias' %}">Categorias</a>
            <a href="{% url 'pesagem' %}">Pesagem</a>
            <a href="{% url 'lista_chaves' %}">Chaves</a>
            <a href="{% url 'ranking_academias' %}">Ranking</a>
            <a href="{% url 'dashboard' %}">üìä Dashboard</a>
            <a href="{% url 'relatorio_atletas_inscritos' %}">Relat√≥rios</a>
            <a href="#" onclick="abrirModalReset(); return false;" style="color: #dc3545; font-weight: bold;">üîÑ Resetar Campeonato</a>
        </nav>
        
        {% block content %}{% endblock %}
    </div>
        <!-- Modal Reset Campeonato -->
        <div id="modal-reset" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 10000; align-items: center; justify-content: center;">
            <div style="background: white; padding: 30px; border-radius: 10px; max-width: 500px; width: 90%; box-shadow: 0 10px 30px rgba(0,0,0,0.3);">
                <h2 style="margin-top: 0; color: #dc3545;">‚ö†Ô∏è Resetar Campeonato</h2>
                <p style="margin: 20px 0; color: #666;">Esta a√ß√£o ir√°:</p>
                <ul style="margin: 20px 0; padding-left: 30px; color: #666;">
                    <li>Zerar TODAS as lutas</li>
                    <li>Zerar pontua√ß√µes e rankings</li>
                    <li>Resetar pesagens e remanejamentos</li>
                    <li>Manter atletas, academias e categorias</li>
                </ul>
                <p style="margin: 20px 0; color: #dc3545; font-weight: bold;">‚ö†Ô∏è Esta a√ß√£o n√£o pode ser desfeita!</p>
                <form id="form-reset" style="margin-top: 20px;">
                    {% csrf_token %}
                    <div style="margin-bottom: 15px;">
                        <label for="senha-reset" style="display: block; margin-bottom: 5px; font-weight: bold;">Senha de Administrador:</label>
                        <input type="password" id="senha-reset" name="senha" required 
                               style="width: 100%; padding: 10px; font-size: 16px; border: 2px solid #ddd; border-radius: 5px; box-sizing: border-box;">
                    </div>
                    <div id="mensagem-reset" style="margin: 10px 0; padding: 10px; border-radius: 5px; display: none;"></div>
                    <div style="display: flex; gap: 10px; justify-content: flex-end; margin-top: 20px;">
                        <button type="button" onclick="fecharModalReset()" 
                                style="padding: 10px 20px; background: #6c757d; color: white; border: none; border-radius: 5px; cursor: pointer;">
                            Cancelar
                        </button>
                        <button type="submit" 
                                style="padding: 10px 20px; background: #dc3545; color: white; border: none; border-radius: 5px; cursor: pointer; font-weight: bold;">
                            üîÑ Resetar
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <script>
        function useIsMobile() {
            const width = window.innerWidth || document.documentElement.clientWidth;
            const ua = navigator.userAgent || navigator.vendor || window.opera || '';
            const byWidth = width <= 768;
            const byUA = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(ua);
            const byMedia = window.matchMedia && window.matchMedia("(max-width: 768px)").matches;
            return !!(byWidth || byUA || byMedia);
        }

        function applyResponsiveFlags() {
            const isMobile = useIsMobile();
            document.documentElement.dataset.isMobile = isMobile ? '1' : '0';
            document.body.classList.toggle('is-mobile', isMobile);
        }

        document.addEventListener('DOMContentLoaded', function () {
            applyResponsiveFlags();

            function abrirModalReset() {
                document.getElementById('modal-reset').style.display = 'flex';
                document.getElementById('senha-reset').focus();
            }

            function fecharModalReset() {
                document.getElementById('modal-reset').style.display = 'none';
                document.getElementById('form-reset').reset();
                document.getElementById('mensagem-reset').style.display = 'none';
            }

            window.abrirModalReset = abrirModalReset;
            window.fecharModalReset = fecharModalReset;

            const formReset = document.getElementById('form-reset');
            if (formReset) {
                formReset.addEventListener('submit', function(e) {
                    e.preventDefault();
                    
                    const senha = document.getElementById('senha-reset').value;
                    const mensagem = document.getElementById('mensagem-reset');
                    const csrfToken = document.querySelector('[name=csrfmiddlewaretoken]').value;
                    
                    fetch('{% url "reset_campeonato" %}', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'X-CSRFToken': csrfToken
                        },
                        body: JSON.stringify({ senha: senha })
                    })
                    .then(async response => {
                        const data = await response.json().catch(() => ({}));
                        mensagem.style.display = 'block';
                        if (response.ok && data.detail) {
                            mensagem.style.background = '#d4edda';
                            mensagem.style.color = '#155724';
                            mensagem.textContent = data.detail;
                            setTimeout(() => {
                                window.location.reload();
                            }, 2000);
                        } else {
                            mensagem.style.background = '#f8d7da';
                            mensagem.style.color = '#721c24';
                            mensagem.textContent = data.detail || 'Senha incorreta. A√ß√£o n√£o autorizada.';
                        }
                    })
                    .catch(error => {
                        mensagem.style.display = 'block';
                        mensagem.style.background = '#f8d7da';
                        mensagem.style.color = '#721c24';
                        mensagem.textContent = 'Erro ao processar requisi√ß√£o';
                    });
                });
            }

            const modalReset = document.getElementById('modal-reset');
            if (modalReset) {
                modalReset.addEventListener('click', function(e) {
                    if (e.target === this) {
                        fecharModalReset();
                    }
                });
            }

            window.addEventListener('resize', function () {
                applyResponsiveFlags();
            });
        });
        </script>
    </body>
</html>
