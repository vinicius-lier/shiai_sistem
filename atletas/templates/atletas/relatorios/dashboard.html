{% extends 'atletas/base.html' %}
{% load static %}

{% block title %}M√©tricas - Sistema de Gest√£o de Competi√ß√µes de Jud√¥{% endblock %}

{% block content %}

<!-- Cabe√ßalho -->
<div class="page-header" style="margin-bottom: var(--spacing-8);">
    <div style="display: flex; align-items: center; gap: var(--spacing-4); margin-bottom: var(--spacing-2);">
        <div style="width: 56px; height: 56px; border-radius: var(--border-radius-lg); background: linear-gradient(135deg, var(--color-primary) 0%, var(--color-secondary) 100%); display: flex; align-items: center; justify-content: center; box-shadow: var(--shadow-lg);">
            <svg viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="width: 32px; height: 32px;">
                <line x1="12" y1="20" x2="12" y2="10"></line>
                <line x1="18" y1="20" x2="18" y2="4"></line>
                <line x1="6" y1="20" x2="6" y2="16"></line>
            </svg>
        </div>
        <div style="flex: 1;">
            <h1 class="page-title">M√©tricas</h1>
            <p class="page-description">An√°lises e indicadores gerais do sistema</p>
        </div>
    </div>
</div>

{% if total_atletas == 0 %}
<!-- Estado Vazio -->
<div class="card">
    <div class="empty-state">
        <svg class="empty-state-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="12" y1="20" x2="12" y2="10"></line>
            <line x1="18" y1="20" x2="18" y2="4"></line>
            <line x1="6" y1="20" x2="6" y2="16"></line>
        </svg>
        <div class="empty-state-title">Nenhum dado dispon√≠vel ainda</div>
        <div class="empty-state-description">Cadastre atletas para ativar as m√©tricas do sistema</div>
        <a href="{% url 'cadastrar_atleta' organizacao_slug=request.organizacao.slug %}" class="btn btn-primary" style="margin-top: var(--spacing-4);">
            Cadastrar Atleta
        </a>
    </div>
</div>

{% else %}
<!-- Indicadores Principais -->
<div class="stats-grid" style="margin-bottom: var(--spacing-8);">
    <div class="stat-card">
        <div class="stat-card-header">
            <span class="stat-card-title">Total de Atletas</span>
            <div class="stat-card-icon">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                    <circle cx="9" cy="7" r="4"></circle>
                </svg>
            </div>
        </div>
        <div class="stat-card-value">{{ total_atletas }}</div>
        <div class="stat-card-change">Atletas cadastrados</div>
    </div>

    <div class="stat-card">
        <div class="stat-card-header">
            <span class="stat-card-title">Atletas OK</span>
            <div class="stat-card-icon">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="22 4 12 14.01 9 11.01"></polyline>
                </svg>
            </div>
        </div>
        <div class="stat-card-value">{{ total_atletas_ok }}</div>
        <div class="stat-card-change">Aptos para competir</div>
    </div>

    <div class="stat-card">
        <div class="stat-card-header">
            <span class="stat-card-title">Festival</span>
            <div class="stat-card-icon">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M12 2v20" />
                </svg>
            </div>
        </div>
        <div class="stat-card-value">{{ total_festival }}</div>
        <div class="stat-card-change">Atletas do festival</div>
    </div>

    <div class="stat-card">
        <div class="stat-card-header">
            <span class="stat-card-title">Total de Medalhas</span>
            <div class="stat-card-icon">
                üèÖ
            </div>
        </div>
        <div class="stat-card-value">{{ total_ouros|add:total_pratas|add:total_bronzes }}</div>
        <div class="stat-card-change">
            ü•á {{ total_ouros }} ‚Ä¢ ü•à {{ total_pratas }} ‚Ä¢ ü•â {{ total_bronzes }}
        </div>
    </div>
</div>

<!-- Atletas por Classe -->
{% if atletas_por_classe %}
<div class="table-container">
    <h2>üìà Atletas por Classe</h2>
    <table class="table">
        <thead>
            <tr>
                <th>Classe</th>
                <th>Total</th>
                <th>Percentual</th>
            </tr>
        </thead>
        <tbody>
            {% for item in atletas_por_classe %}
            <tr>
                <td>{{ item.classe }}</td>
                <td>{{ item.total }}</td>
                <td>
                    {% widthratio item.total total_atletas 100 %}%
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endif %}

<!-- Atletas por Academia -->
{% if atletas_por_academia %}
<div class="table-container">
    <h2>üè´ Atletas por Academia</h2>
    <table class="table">
        <thead>
            <tr>
                <th>Academia</th>
                <th>Total</th>
                <th>Percentual</th>
            </tr>
        </thead>
        <tbody>
            {% for item in atletas_por_academia %}
            <tr>
                <td>{{ item.academia__nome }}</td>
                <td>{{ item.total }}</td>
                <td>{% widthratio item.total total_atletas 100 %}%</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endif %}

<!-- Medalhas por Academia -->
{% if medalhas_por_academia %}
<div class="table-container">
    <h2>üèÖ Medalhas por Academia</h2>
    <table class="table">
        <thead>
            <tr>
                <th>Academia</th>
                <th>ü•á Ouro</th>
                <th>ü•à Prata</th>
                <th>ü•â Bronze</th>
                <th>Total</th>
            </tr>
        </thead>
        <tbody>
            {% for item in medalhas_por_academia %}
            <tr>
                <td>{{ item.academia.nome }}</td>
                <td>{{ item.ouro }}</td>
                <td>{{ item.prata }}</td>
                <td>{{ item.bronze }}</td>
                <td>{{ item.total_medalhas }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endif %}

<!-- Resumo de Medalhas -->
<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: var(--spacing-6); margin-bottom: var(--spacing-8);">
    <div class="card">
        <h3>ü•á Total Ouros</h3>
        <p style="font-size: 28px;">{{ total_ouros }}</p>
    </div>
    <div class="card">
        <h3>ü•à Total Pratas</h3>
        <p style="font-size: 28px;">{{ total_pratas }}</p>
    </div>
    <div class="card">
        <h3>ü•â Total Bronzes</h3>
        <p style="font-size: 28px;">{{ total_bronzes }}</p>
    </div>
</div>

{% endif %}

{% endblock %}
