{% extends 'atletas/academia/base_academia.html' %}
{% load static %}

{% block title %}Cadastrar Atleta - {{ academia.nome }}{% endblock %}

{% block extra_css %}
<style>
    .btn-back {
        display: inline-flex;
        align-items: center;
        gap: var(--spacing-2);
        color: var(--color-primary);
        text-decoration: none;
        font-size: var(--font-size-sm);
        margin-bottom: var(--spacing-4);
        font-weight: 500;
    }

    .btn-back:hover {
        color: var(--color-primary-hover);
    }

    .form-grid {
        display: grid;
        grid-template-columns: 1fr;
        gap: var(--spacing-6);
    }

    @media (min-width: 768px) {
        .form-grid {
            grid-template-columns: repeat(2, 1fr);
        }
    }

    .form-group-full {
        grid-column: 1 / -1;
    }

    .checkbox-group {
        display: flex;
        align-items: center;
        gap: var(--spacing-2);
        padding: var(--spacing-3);
        background: var(--color-gray-50);
        border-radius: var(--border-radius-md);
        border: 1px solid var(--color-gray-200);
    }

    .checkbox-group input[type="checkbox"] {
        width: 20px;
        height: 20px;
        cursor: pointer;
    }

    .checkbox-group label {
        margin: 0;
        cursor: pointer;
        font-weight: 500;
    }

    .form-help {
        display: block;
        margin-top: var(--spacing-1);
        color: var(--color-gray-500);
        font-size: var(--font-size-xs);
    }

    .required-mark {
        color: var(--color-danger);
    }
</style>
{% endblock %}

{% block content %}
<div class="page-header">
    {% if campeonato %}
    <a href="{% url 'academia_inscrever_atletas' campeonato.id %}" class="btn-back">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="width: 16px; height: 16px;">
            <polyline points="15 18 9 12 15 6"></polyline>
        </svg>
        Voltar para inscrições
    </a>
    {% else %}
    <a href="{% url 'academia_lista_atletas' %}" class="btn-back">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="width: 16px; height: 16px;">
            <polyline points="15 18 9 12 15 6"></polyline>
        </svg>
        Voltar para atletas
    </a>
    {% endif %}
    
    <div style="display: flex; align-items: center; gap: var(--spacing-4); margin-top: var(--spacing-4); flex-wrap: wrap;">
        {% if academia.foto_perfil %}
        <img src="{{ academia.foto_perfil.url }}" alt="{{ academia.nome }}" style="max-width: 60px; max-height: 60px; height: auto; border-radius: var(--border-radius-md); object-fit: contain; flex-shrink: 0;" onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
        <img src="{% static 'atletas/images/logo_black.png' %}" alt="SHIAI SISTEM" style="max-width: 60px; height: auto; display: none; flex-shrink: 0;">
        {% else %}
        <img src="{% static 'atletas/images/logo_black.png' %}" alt="SHIAI SISTEM" style="max-width: 60px; height: auto; flex-shrink: 0;">
        {% endif %}
        <div style="flex: 1; min-width: 200px;">
            <h1 class="page-title" style="margin: 0;">Cadastrar Novo Atleta</h1>
            <p class="page-description" style="margin: var(--spacing-1) 0 0 0;">{{ academia.nome }}</p>
        </div>
    </div>
</div>

<div class="card">
    <div class="card-body">
        <form method="post" enctype="multipart/form-data">
            {% csrf_token %}
            
            <input type="hidden" name="academia" value="{{ academia.id }}">
            
            <div class="form-grid">
                <div class="form-group form-group-full">
                    <label class="form-label" for="nome">
                        Nome completo
                        <span class="required-mark">*</span>
                    </label>
                    <input type="text" id="nome" name="nome" class="form-input" required placeholder="Digite o nome completo do atleta">
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="data_nascimento">
                        Data de Nascimento
                        <span class="required-mark">*</span>
                    </label>
                    <input type="date" id="data_nascimento" name="data_nascimento" class="form-input" required>
                    <span class="form-help">A classe será calculada automaticamente</span>
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="sexo">
                        Sexo
                        <span class="required-mark">*</span>
                    </label>
                    <select id="sexo" name="sexo" class="form-select" required>
                        <option value="">Selecione</option>
                        <option value="M">Masculino</option>
                        <option value="F">Feminino</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="faixa">
                        Faixa
                    </label>
                    <select id="faixa" name="faixa" class="form-select">
                        <option value="">Selecione a faixa</option>
                        <option value="BRANCA">Branca</option>
                        <option value="P.CINZA">P. Cinza</option>
                        <option value="CINZA">Cinza</option>
                        <option value="P.AZUL">P. Azul</option>
                        <option value="AZUL">Azul</option>
                        <option value="P.AMARELA">P. Amarela</option>
                        <option value="AMARELA">Amarela</option>
                        <option value="P.LARANJA">P. Laranja</option>
                        <option value="LARANJA">Laranja</option>
                        <option value="VERDE">Verde</option>
                        <option value="ROXA">Roxa</option>
                        <option value="MARRON">Marrom</option>
                        <option value="PRETA">Preta</option>
                    </select>
                </div>
                
                <div class="form-group form-group-full">
                    <label class="form-label" for="foto_perfil">
                        Foto de Perfil
                    </label>
                    <input type="file" id="foto_perfil" name="foto_perfil" class="form-input" accept=".jpg,.jpeg,.png,.heic" onchange="previewFoto(this, 'foto-preview')">
                    <span class="form-help">Formatos aceitos: JPG, PNG, HEIC (máximo 2MB)</span>
                    <div id="foto-preview" style="margin-top: var(--spacing-3); display: none;">
                        <img id="foto-preview-img" src="" alt="Preview" style="max-width: 200px; max-height: 200px; border-radius: var(--border-radius-md); border: 2px solid var(--color-gray-300);">
                    </div>
                </div>
                
                <div class="form-group form-group-full">
                    <label class="form-label" for="documento_oficial">
                        Documento Oficial (RG, CPF ou Certidão)
                        <span class="required-mark">*</span>
                    </label>
                    <input type="file" id="documento_oficial" name="documento_oficial" class="form-input" accept=".jpg,.jpeg,.png,.pdf,.heic" required>
                    <span class="form-help">Formatos aceitos: JPG, PNG, PDF ou HEIC (máximo 5MB)</span>
                </div>
                
                <div class="form-group form-group-full">
                    <label style="display: flex; align-items: center; gap: var(--spacing-2); cursor: pointer; padding: var(--spacing-3); border: 1px solid var(--color-gray-300); border-radius: var(--border-radius-md); transition: all var(--transition-base);">
                        <input type="checkbox" id="federado" name="federado" style="width: 20px; height: 20px; cursor: pointer; flex-shrink: 0;" onchange="toggleZempo()">
                        <div>
                            <span style="font-size: var(--font-size-sm); font-weight: 500; color: var(--color-gray-700);">
                                Atleta Federado
                            </span>
                            <small style="display: block; margin-top: var(--spacing-1); color: var(--color-gray-500); font-weight: normal;">
                                Marque se o atleta possui registro na federação
                            </small>
                        </div>
                    </label>
                </div>
                
                <div class="form-group form-group-full" id="zempo-group" style="display: none;">
                    <label class="form-label" for="numero_zempo">
                        Número Zempo
                        <span class="required-mark">*</span>
                    </label>
                    <input type="text" id="numero_zempo" name="numero_zempo" class="form-input" placeholder="Digite o número Zempo do atleta">
                    <span class="form-help">Obrigatório para atletas federados</span>
                </div>
            </div>
            
            <div class="flex gap-3 mt-6" style="flex-wrap: wrap;">
                <button type="submit" class="btn btn-primary">Cadastrar Atleta</button>
                {% if campeonato %}
                <a href="{% url 'academia_inscrever_atletas' campeonato.id %}" class="btn btn-secondary" style="text-decoration: none;">Cancelar</a>
                {% else %}
                <a href="{% url 'academia_lista_atletas' %}" class="btn btn-secondary" style="text-decoration: none;">Cancelar</a>
                {% endif %}
            </div>
        </form>
    </div>
</div>

<script>
function toggleZempo() {
    const federado = document.getElementById('federado').checked;
    const zempoGroup = document.getElementById('zempo-group');
    const zempoInput = document.getElementById('numero_zempo');
    
    if (federado) {
        zempoGroup.style.display = 'block';
        zempoInput.required = true;
    } else {
        zempoGroup.style.display = 'none';
        zempoInput.required = false;
        zempoInput.value = '';
    }
}

// Preview de foto
function previewFoto(input, previewId) {
    const preview = document.getElementById(previewId);
    const previewImg = document.getElementById(previewId + '-img');
    
    if (input.files && input.files[0]) {
        const reader = new FileReader();
        
        reader.onload = function(e) {
            previewImg.src = e.target.result;
            preview.style.display = 'block';
        };
        
        reader.readAsDataURL(input.files[0]);
    } else {
        preview.style.display = 'none';
    }
}

// Validar antes de enviar
document.querySelector('form').addEventListener('submit', function(e) {
    const federado = document.getElementById('federado').checked;
    const numeroZempo = document.getElementById('numero_zempo').value.trim();
    const documentoOficial = document.getElementById('documento_oficial').files.length;
        
    if (federado && !numeroZempo) {
        e.preventDefault();
        alert('Por favor, informe o número Zempo para atletas federados.');
        document.getElementById('numero_zempo').focus();
        return false;
    }
    
    if (!documentoOficial) {
        e.preventDefault();
        alert('Por favor, anexe o documento oficial do atleta.');
        document.getElementById('documento_oficial').focus();
        return false;
    }
});
</script>
{% endblock %}
